<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xsi:schemaLocation="http://www.springframework.org/schema/beans
 http://www.springframework.org/schema/beans/spring-beans.xsd">
    <bean id="jmsConnectionFactory" class="org.apache.activemq.pool.PooledConnectionFactory" destroy-method="stop">
        <property name="connectionFactory">
            <bean class="org.apache.activemq.ActiveMQConnectionFactory">
                <property name="brokerURL" value="${jms.broker_url}"/>
                <!-- 是否异步发送 -->
                <property name="useAsyncSend" value="false"/>
                <!--这里定义重试策略,注意：只有持久化的才会重试-->
                <property name="redeliveryPolicy" ref="redeliveryPolicy" />
            </bean>
        </property>
    </bean>

    <bean id="redeliveryPolicy" class="org.apache.activemq.RedeliveryPolicy">
        <!--重发次数 延时、延时系数、延时指数开关、目标（重发等待时间1s, 2s, 4s, 8s）-->
        <property name="maximumRedeliveries" value="3"/>
        <property name="initialRedeliveryDelay" value="1000"/>
        <property name="backOffMultiplier" value="2"/>
        <property name="useExponentialBackOff" value="true"/>
    </bean>

    <bean id="jmsTemplate" class="org.springframework.jms.core.JmsTemplate">
        <property name="connectionFactory" ref="jmsConnectionFactory"/>
        <!--deliveryMode 1:非持久 2：持久 非持久化：高吞吐，易丢失；持久化：低吞吐，不易丢失。 -->
        <property name="deliveryMode" value="${delivery_mode}"/>
        <!-- 0最低，9最高。0-4作为一般的优先级，5-9作为加速优先级 -->
        <property name="priority" value="${priority}"/>
        <!-- 使 deliveryMode, priority, timeToLive设置生效 -->
        <property name="explicitQosEnabled" value="${explicitQosEnabled}"/>
        <!--这里注意:如果不开启事务，消息在异常的情况下是不会重试的 -->
        <property name="sessionTransacted" value="${sessionTransacted}"/>
        <property name="pubSubDomain" value="false"/>
    </bean>
</beans>